<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CBC Play School</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        #uiContainer {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 15px;
            color: white;
            max-width: 300px;
        }
        #questionBox {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #ffcc00;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }
        #scoreBox {
            font-size: 1.8em;
            font-weight: bold;
            color: #4cff00;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }
        #livesBox {
            font-size: 1.5em;
            font-weight: bold;
            color: #ff3366;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            z-index: 100;
            display: none;
            border: 3px solid #ff0000;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
        }
        #finalScore {
            font-size: 2.5em;
            color: #ffcc00;
            margin: 20px 0;
        }
        #restartBtn {
            background: linear-gradient(to bottom, #ff3366, #cc0066);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        #restartBtn:hover {
            background: linear-gradient(to bottom, #ff6699, #ff0066);
            transform: scale(1.05);
        }
        #instructions {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9em;
            max-width: 300px;
        }
        #settingsPanel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            z-index: 100;
            border: 3px solid #4cff00;
            box-shadow: 0 0 30px rgba(76, 255, 0, 0.5);
        }
        #settingsPanel h2 {
            color: #ffcc00;
            margin-top: 0;
        }
        .setting-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        input, select {
            padding: 8px;
            border-radius: 5px;
            border: 2px solid #4cff00;
            background: #333;
            color: white;
            font-size: 1em;
            width: 100px;
            text-align: center;
        }
        #startBtn {
            background: linear-gradient(to bottom, #4cff00, #33cc00);
            color: black;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            margin-top: 20px;
        }
        #startBtn:hover {
            background: linear-gradient(to bottom, #66ff33, #4cff00);
            transform: scale(1.05);
        }
        #mathSettings {
            display: block;
        }
        #languageSettings {
            display: none;
        }
        canvas {
            display: block;
        }
        #soundToggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: 2px solid #4cff00;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            z-index: 20;
        }
        #winScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            z-index: 100;
            display: none;
            border: 3px solid #4cff00;
            box-shadow: 0 0 30px rgba(76, 255, 0, 0.5);
        }
        #winMessage {
            font-size: 2em;
            color: #4cff00;
            margin-bottom: 20px;
        }
        #nextLevelBtn {
            background: linear-gradient(to bottom, #4cff00, #33cc00);
            color: black;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            margin-top: 20px;
        }
        #nextLevelBtn:hover {
            background: linear-gradient(to bottom, #66ff33, #4cff00);
            transform: scale(1.05);
        }
        #badgesContainer {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
            background: rgba(0, 0, 0, 0.0);
            padding: 10px;
            border-radius: 15px;
            color: black;
            min-width: 150px;
        }
        .badge {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: #ffcc00;
            border-radius: 50%;
            margin: 5px;
            text-align: center;
            line-height: 40px;
            font-weight: bold;
            color: black;
            box-shadow: 0 0 5px rgba(255, 204, 0, 0.8);
        }
        .badge.locked {
            background: #666;
            color: #999;
            box-shadow: none;
        }
        #starsContainer {
            position: absolute;
            top: 110px;
            right: 20px;
            z-index: 10;
            background: rgba(0, 0, 0, 0.0);
            padding: 10px;
            border-radius: 15px;
            color: black;
            min-width: 150px;
        }
        .star {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #ffcc00;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            margin: 5px;
        }
        .star.inactive {
            background: #666;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="uiContainer">
            <div id="questionBox">Choose your game mode</div>
            <div id="scoreBox">Score: 0</div>
            <div id="livesBox">Lives: 3</div>
        </div>
        <div id="badgesContainer">
            <h3>Badges</h3>
            <div id="badgesDisplay"></div>
        </div>
        <div id="starsContainer">
            <h3>Stars</h3>
            <div id="starsDisplay"></div>
        </div>
        <div id="instructions">
            Use arrow keys to move and SPACE to jump. Capture the correct answers!
        </div>
        <div id="gameOver">
            <h2>Game Over!</h2>
            <div id="finalScore">Score: 0</div>
            <button id="restartBtn">Play Again</button>
        </div>
        <div id="winScreen">
            <h2 id="winMessage">Level Complete!</h2>
            <div id="winText">All questions answered correctly!</div>
            <button id="nextLevelBtn">Next Level</button>
        </div>
        <div id="settingsPanel">
            <h2>Game Settings</h2>
            <div class="setting-group">
                <label for="gameMode">Game Mode:</label>
                <select id="gameMode">
                    <option value="math">Math</option>
                    <option value="language">Language</option>
                </select>
            </div>
            
            <div id="mathSettings">
                <div class="setting-group">
                    <label for="minNum">Min Number:</label>
                    <input type="number" id="minNum" value="1" min="0" max="100">
                </div>
                <div class="setting-group">
                    <label for="maxNum">Max Number:</label>
                    <input type="number" id="maxNum" value="10" min="1" max="1000">
                </div>
            </div>
            
            <div id="languageSettings">
                <div class="setting-group">
                    <label for="languageLevel">Language Level:</label>
                    <select id="languageLevel">
                        <option value="playgroup">Play Group (Easy)</option>
                        <option value="jss">JSS (Medium)</option>
                        <option value="sss">SSS (Hard)</option>
                    </select>
                </div>
            </div>
            
            <button id="startBtn">Start Game</button>
        </div>
        <button id="soundToggle">🔊</button>
    </div>

    <script>
        let score = 0;
        let lives = 3;
        let gameActive = false;
        let currentQuestion = "";
        let correctAnswer = 0;
        let answers = [];
        let answerElements = [];
        let gameMode = "math";
        let minNum = 1;
        let maxNum = 10;
        let languageLevel = "playgroup";
        let soundEnabled = true;
        let correctStreak = 0; 
        let totalCorrectAnswers = 0; 
        let earnedStars = 0; 
        let earnedBadges = []; 
        let questionsAnswered = 0; 
        let levelComplete = false;
        
        // Monster animation variables
        let isBiting = false;
        let biteStartTime = 0;
        let biteDuration = 300; 
        
        // Badge definitions
        const badges = [
            { id: "first_win", name: "First Win", description: "Answer 5 questions correctly", requirement: 5, type: "correct_total" },
            { id: "streak_master", name: "Streak Master", description: "Get 3 correct answers in a row", requirement: 3, type: "streak" },
            { id: "level_complete", name: "Level Complete", description: "Finish a level", requirement: 1, type: "level_complete" },
            { id: "star_collector", name: "Star Collector", description: "Earn 3 stars", requirement: 3, type: "stars" }
        ];
        
       
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();
        
        function playCorrectSound() {
            if (!soundEnabled) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.5);
        }
        
        function playWrongSound() {
            if (!soundEnabled) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(220, audioCtx.currentTime); // A3
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.8);
            
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.8);
        }
        
        function playJumpSound() {
            if (!soundEnabled) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(330, audioCtx.currentTime); // E4
            oscillator.frequency.exponentialRampToValueAtTime(440, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.2);
        }
        
        function playBiteSound() {
            if (!soundEnabled) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(440, audioCtx.currentTime); // A4
            oscillator.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1); // A5
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.2);
        }
        
        function playBackgroundMusic() {
            if (!soundEnabled) return;
            const now = audioCtx.currentTime;
            
            for (let i = 0; i < 8; i++) {
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                
                oscillator.type = 'sine';
                const notes = [261.63, 329.63, 392.00, 523.25]; 
                oscillator.frequency.setValueAtTime(notes[i % notes.length], now + i * 0.5);
                gainNode.gain.setValueAtTime(0.1, now + i * 0.5);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + i * 0.5 + 0.4);
                
                oscillator.start(now + i * 0.5);
                oscillator.stop(now + i * 0.5 + 0.5);
            }
        }
        
        function playStarSound() {
            if (!soundEnabled) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(880, audioCtx.currentTime); 
            oscillator.frequency.exponentialRampToValueAtTime(1760, audioCtx.currentTime + 0.5);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.5);
        }
        
        function playBadgeSound() {
            if (!soundEnabled) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.type = 'sine';
            const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
            for (let i = 0; i < notes.length; i++) {
                oscillator.frequency.setValueAtTime(notes[i], audioCtx.currentTime + i * 0.15);
            }
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.6);
            
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.6);
        }
        
        // Canvas setup
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        document.getElementById('gameContainer').appendChild(canvas);
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        //Purple Monster
        const player = {
            x: 100,
            y: canvas.height - 150,
            width: 80,
            height: 80,
            velocityY: 0,
            jumpPower: -29,
            gravity: 0.8,
            speed: 8,
            isJumping: false
        };
        
        // Ground
        const ground = {
            y: canvas.height - 70,
            height: 70
        };
        
        const playGroupQuestions = [
            { question: "What color is the sky?", answers: ["Blue", "Green", "Red", "Yellow"] },
            { question: "How many legs does a cat have?", answers: ["4", "2", "6", "8"] },
            { question: "What do you use to eat soup?", answers: ["Spoon", "Fork", "Knife", "Plate"] },
            { question: "Which is the missing word? C__t", answers: ["a", "e", "u", "i"] },
            { question: "Which animal says 'Moo'?", answers: ["Cow", "Dog", "Cat", "Pig"] },
            { question: "Spot the wild animal ?", answers: ["Lion", "Dog", "Goat", "Pig"] },
            { question: "What do you call a baby dog?", answers: ["Puppy", "Kitten", "Cub", "Calf"] },
            { question: "What is the opposite of 'hot'?", answers: ["Cold", "Warm", "Cool", "Boiling"] },
            { question: "What do you drink?", answers: ["Water", "Food", "Air", "Light"] },
            { question: "What is the color of grass?", answers: ["Green", "Blue", "Red", "Yellow"] },
            { question: "What do you use to write?", answers: ["Pencil", "Spoon", "Fork", "Knife"] },
            { question: "What is the sound of a dog?", answers: ["Bark", "Meow", "Moo", "Roar"] },
            { question: "What do you wear on your head?", answers: ["Hat", "Shoe", "Glove", "Shirt"] },
            { question: "What is the color of a banana?", answers: ["Yellow", "Blue", "Red", "Green"] },
            { question: "What do you call a baby cat?", answers: ["Kitten", "Puppy", "Cub", "Calf"] },
            { question: "What do you use to cut paper?", answers: ["Scissors", "Spoon", "Fork", "Knife"] },
            { question: "What is the opposite of 'big'?", answers: ["Small", "Tall", "Wide", "Long"] },
            { question: "What do you call a baby cow?", answers: ["Calf", "Puppy", "Kitten", "Cub"] },
            { question: "What is the color of an orange?", answers: ["Orange", "Blue", "Red", "Green"] },
            { question: "What do you use to brush your teeth?", answers: ["Toothbrush", "Spoon", "Fork", "Knife"] },
            { question: "What is the sound of a cat?", answers: ["Meow", "Bark", "Moo", "Roar"] },
            { question: "What do you wear on your hands?", answers: ["Gloves", "Hat", "Shoe", "Shirt"] },
            { question: "What shape is a ball?", answers: ["Round", "Square", "Triangle", "Rectangle"] },
            { question: "What do you wear on your feet?", answers: ["Shoes", "Hat", "Gloves", "Shirt"] },
            { question: "How many fingers do you have on one hand?", answers: ["5", "4", "6", "10"] },
            { question: "What do birds have that helps them fly?", answers: ["Wings", "Feet", "Tail", "Beak"] }
        ];
        
        const jssQuestions = [
            { question: "What is the past tense of 'go'?", answers: ["Went", "Goed", "Gone", "Going"] },
            { question: "Which word is a noun?", answers: ["Apple", "Run", "Quickly", "Beautiful"] },
            { question: "What is the opposite of 'begin'?", answers: ["End", "Start", "Continue", "Finish"] },
            { question: "Choose the correct sentence:", answers: ["She likes apples.", "She like apples.", "She liking apples.", "She liked apples."] },
            { question: "Which word rhymes with 'cat'?", answers: ["Bat", "Dog", "Fish", "Bird"] },
            { question: "What is a synonym for 'happy'?", answers: ["Joyful", "Sad", "Angry", "Tired"] },
            { question: "Which is a verb?", answers: ["Running", "Beautiful", "Quickly", "House"] },
            { question: "How many syllables are in 'butterfly'?", answers: ["3", "2", "4", "5"] }
        ];
        
        const sssQuestions = [
            { question: "What figure of speech is 'The world is a stage'?", answers: ["Metaphor", "Simile", "Personification", "Hyperbole"] },
            { question: "What is the plural of 'cactus'?", answers: ["Cacti", "Cactuses", "Cactuss", "Cacti's"] },
            { question: "Which is an example of alliteration?", answers: ["Peter Piper picked", "The cat sat", "Big bad wolf", "Red rose"] },
            { question: "What is the main verb in 'She has been running'?", answers: ["Running", "Has", "Been", "She"] },
            { question: "What type of sentence is 'What a beautiful day!'?", answers: ["Exclamatory", "Interrogative", "Declarative", "Imperative"] },
            { question: "Which word is an adjective?", answers: ["Beautiful", "Quickly", "Running", "Happiness"] },
            { question: "What is the subject in 'The tall man walked slowly'?", answers: ["Man", "Tall", "Walked", "Slowly"] },
            { question: "What is a conjunction?", answers: ["And", "Run", "Beautiful", "Quickly"] }
        ];
        
        const countingQuestions = [
            { 
                question: "How many apples are there?",
                image: "🍎🍎🍎", 
                answer: 3,
                wrongAnswers: [1, 2, 4]
            },
            { 
                question: "Count the stars:",
                image: "⭐⭐⭐⭐",
                answer: 4,
                wrongAnswers: [2, 3, 5]
            },
            { 
                question: "How many balloons?",
                image: "🎈🎈", 
                answer: 2,
                wrongAnswers: [1, 3, 4]
            },
            { 
                question: "Count the cars:",
                image: "🚗🚗🚗🚗🚗", 
                answer: 5,
                wrongAnswers: [3, 4, 6]
            },
            { 
                question: "How many cats?",
                image: "🐱🐱🐱🐱", 
                answer: 4,
                wrongAnswers: [6, 5, 7]
            },
            { 
                question: "Count the flowers:",
                image: "🌸🌸🌸🌸🌸🌸🌸",
                answer: 7,
                wrongAnswers: [5, 6, 8]
            },
            { 
                question: "How many dogs?",
                image: "🐶🐶🐶🐶🐶",
                answer: 5,
                wrongAnswers: [6, 7, 9]
            },
            { 
                question: "Count the birds:",
                image: "🐦🐦🐦🐦", 
                answer: 4,
                wrongAnswers: [3, 5, 6]
            }
        ];
        
        document.getElementById('gameMode').addEventListener('change', function() {
            if (this.value === 'math') {
                document.getElementById('mathSettings').style.display = 'block';
                document.getElementById('languageSettings').style.display = 'none';
            } else {
                document.getElementById('mathSettings').style.display = 'none';
                document.getElementById('languageSettings').style.display = 'block';
            }
        });
        
        document.getElementById('soundToggle').addEventListener('click', function() {
            soundEnabled = !soundEnabled;
            this.textContent = soundEnabled ? '🔊' : '🔇';
        });
        
        function generateMathQuestion() {
            if (Math.random() > 0.5 && maxNum <= 10) {
                generateCountingQuestion();
                return;
            }
            
            const operations = [
                { symbol: '+', method: (a, b) => a + b },
                { symbol: '-', method: (a, b) => a - b },
                { symbol: '×', method: (a, b) => a * b },
                { symbol: '÷', method: (a, b) => b !== 0 ? a / b : a },
                // { symbol: '%', method: (a, b) => a % b },
                // { symbol: '√', method: (a, b) => Math.sqrt(a) },
                // { symbol: '^', method: (a, b) => Math.pow(a, b) },
                // { symbol: '!', method: (a, b) => {
                //     let result = 1;
                //     for (let i = 1; i <= a; i++) {
                //         result *= i;
                //     }
                //     return result;
                // }},
                // { symbol: '∫', method: (a, b) => (a + b) / 2 },
                // { symbol: '∑', method: (a, b) => a + b * (b + 1) / 2 },
                // { symbol: '∏', method: (a, b) => {
                //     let result = 1;
                //     for (let i = a; i <= b; i++) {
                //         result *= i;
                //     }
                //     return result;
                // }},
                // { symbol: 'log', method: (a, b) => Math.log(a) / Math.log(b) },
                // { symbol: 'sin', method: (a, b) => Math.sin(a * Math.PI / 180) },
                // { symbol: 'cos', method: (a, b) => Math.cos(a * Math.PI / 180) },
                // { symbol: 'tan', method: (a, b) => Math.tan(a * Math.PI / 180) },
                // { symbol: 'asin', method: (a, b) => Math.asin(a) * 180 / Math.PI },
                // { symbol: 'acos', method: (a, b) => Math.acos(a) * 180 / Math.PI },
                // { symbol: 'atan', method: (a, b) => Math.atan(a) * 180 / Math.PI },
                // { symbol: 'gcd', method: (a, b) => {
                //     const gcd = (x, y) => y === 0 ? x : gcd(y, x % y);
                //     return gcd(a, b);
                // }},
                // { symbol: 'lcm', method: (a, b) => (a * b) / gcd(a, b) },
                // { symbol: 'round', method: (a, b) => Math.round(a) },
                // { symbol: 'max', method: (a, b) => Math.max(a, b) },
                // { symbol: 'min', method: (a, b) => Math.min(a, b) },
                // { symbol: 'avg', method: (a, b) => (a + b) / 2 },
                // { symbol: 'median', method: (a, b) => {
                //     const arr = [a, b].sort((x, y) => x - y);
                //     return arr.length % 2 === 0 ? (arr[arr.length / 2 - 1] + arr[arr.length / 2]) / 2 : arr[Math.floor(arr.length / 2)];
                // }},
                // { symbol: 'mode', method: (a, b) => {
                //     const freq = {};
                //     [a, b].forEach(num => freq[num] = (freq[num] || 0) + 1);
                //     return Object.keys(freq).reduce((a, b) => freq[a] > freq[b] ? a : b);
                // }},
                // { symbol: 'range', method: (a, b) => Math.max(a, b) - Math.min(a, b) },
                // { symbol: 'percent', method: (a, b) => (a / b) * 100 },
                // { symbol: 'factorial', method: (a, b) => {
                //     let result = 1;
                //     for (let i = 1; i <= a; i++) {
                //         result *= i;
                //     }
                //     return result;
                // }},
                // { symbol: 'power', method: (a, b) => Math.pow(a, b) }
            ];
            
            const opIndex = Math.floor(Math.random() * operations.length);
            const operation = operations[opIndex];
            
            let num1 = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;
            let num2 = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;
            
            if (operation.symbol === '-' && num1 < num2) {
                [num1, num2] = [num2, num1];
            }
            
            if (operation.symbol === '×') {
                num1 = Math.min(num1, 10);
                num2 = Math.min(num2, 10);
            }
            
            correctAnswer = operation.method(num1, num2);
            currentQuestion = `${num1} ${operation.symbol} ${num2} = ?`;
            
            document.getElementById('questionBox').textContent = currentQuestion;
            
            answers = [correctAnswer];
            while (answers.length < 4) {
                let wrongAnswer;
                if (Math.random() > 0.5) {
                    wrongAnswer = correctAnswer + Math.floor(Math.random() * 5) + 1;
                } else {
                    wrongAnswer = Math.floor(Math.random() * (maxNum * 2)) + 1;
                }
                
                if (!answers.includes(wrongAnswer) && wrongAnswer > 0) {
                    answers.push(wrongAnswer);
                }
            }
            
            answers.sort(() => Math.random() - 0.5);
        }
        
        function generateCountingQuestion() {
            const qIndex = Math.floor(Math.random() * countingQuestions.length);
            const question = countingQuestions[qIndex];
            
            currentQuestion = question.question + " " + question.image;
            correctAnswer = question.answer;
            
            document.getElementById('questionBox').textContent = currentQuestion;
            
            answers = [correctAnswer];
            for (let i = 0; i < question.wrongAnswers.length; i++) {
                answers.push(question.wrongAnswers[i]);
            }
            
            answers.sort(() => Math.random() - 0.5);
        }
        
        function generateLanguageQuestion() {
            let questions = [];
            
            switch(languageLevel) {
                case "playgroup":
                    questions = playGroupQuestions;
                    break;
                case "jss":
                    questions = jssQuestions;
                    break;
                case "sss":
                    questions = sssQuestions;
                    break;
            }
            
            const qIndex = Math.floor(Math.random() * questions.length);
            const question = questions[qIndex];
            
            currentQuestion = question.question;
            correctAnswer = question.answers[0];
            
            document.getElementById('questionBox').textContent = currentQuestion;
            
            answers = [...question.answers];
            answers.sort(() => Math.random() - 0.5);
        }
        
        function generateQuestion() {
            if (gameMode === "math") {
                generateMathQuestion();
            } else {
                generateLanguageQuestion();
            }
            
            answerElements = [];
            for (let i = 0; i < answers.length; i++) {
                answerElements.push({
                    value: answers[i],
                    x: canvas.width + i * 300,
                    y: Math.random() * (canvas.height - 250) + 50,
                    width: 70,
                    height: 50,
                    speed: 3 + Math.random() * 2,
                    color: '#ff3366'
                });
            }
        }
        
        function drawPlayer() {
            const currentTime = Date.now();
            
            //hands
            ctx.strokeStyle = '#8A2BE2';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            
            // Left arm
            ctx.beginPath();
            ctx.moveTo(player.x + player.width/2 - 20, player.y + player.height/2 - 10);
            ctx.lineTo(player.x + player.width/2 - 40, player.y + player.height/2 + 20);
            ctx.stroke();
            
            // Right arm
            ctx.beginPath();
            ctx.moveTo(player.x + player.width/2 + 20, player.y + player.height/2 - 10);
            ctx.lineTo(player.x + player.width/2 + 40, player.y + player.height/2 + 20);
            ctx.stroke();
            
            // Left leg
            ctx.beginPath();
            ctx.moveTo(player.x + player.width/2 - 15, player.y + player.height/2 + 30);
            ctx.lineTo(player.x + player.width/2 - 25, player.y + player.height/2 + 60);
            ctx.stroke();
            
            // Right leg
            ctx.beginPath();
            ctx.moveTo(player.x + player.width/2 + 15, player.y + player.height/2 + 30);
            ctx.lineTo(player.x + player.width/2 + 25, player.y + player.height/2 + 60);
            ctx.stroke();
            
            //body
            ctx.fillStyle = '#8A2BE2'; 
            ctx.beginPath();
            ctx.arc(player.x + player.width/2, player.y + player.height/2, player.width/2, 0, Math.PI * 2);
            ctx.fill();
            
            // eyes
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(player.x + player.width/2 - 15, player.y + player.height/2 - 10, 12, 0, Math.PI * 2);
            ctx.arc(player.x + player.width/2 + 15, player.y + player.height/2 - 10, 12, 0, Math.PI * 2);
            ctx.fill();
            
            // pupils
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(player.x + player.width/2 - 15, player.y + player.height/2 - 10, 6, 0, Math.PI * 2);
            ctx.arc(player.x + player.width/2 + 15, player.y + player.height/2 - 10, 6, 0, Math.PI * 2);
            ctx.fill();
            
            if (isBiting && (currentTime - biteStartTime) < biteDuration) {
                const biteProgress = (currentTime - biteStartTime) / biteDuration;
                const mouthWidth = 30;
                const teethHeight = 15;
                
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(player.x + player.width/2, player.y + player.height/2 + 15, mouthWidth, 0.2, Math.PI - 0.2);
                ctx.stroke();
                
                ctx.fillStyle = 'white';
                const toothCount = 5;
                for (let i = 0; i < toothCount; i++) {
                    const toothX = player.x + player.width/2 - mouthWidth + (i * (mouthWidth * 2) / (toothCount - 1));
                    const toothY = player.y + player.height/2 + 15;
                    
                    ctx.beginPath();
                    ctx.moveTo(toothX - 4, toothY);
                    ctx.lineTo(toothX, toothY - teethHeight);
                    ctx.lineTo(toothX + 4, toothY);
                    ctx.closePath();
                    ctx.fill();
                    
                    ctx.strokeStyle = '#ccc';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }
            } else {
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(player.x + player.width/2, player.y + player.height/2 + 10, 20, 0.2, Math.PI - 0.2);
                ctx.stroke();
            }
        }
        
        function triggerBite() {
            isBiting = true;
            biteStartTime = Date.now();
            playBiteSound();
            
            setTimeout(() => {
                isBiting = false;
            }, biteDuration);
        }
        
        function drawGround() {
            ctx.fillStyle = '#7CFC00';
            ctx.fillRect(0, ground.y, canvas.width, ground.height);
            
            ctx.fillStyle = '#5cb300';
            for (let i = 0; i < canvas.width; i += 40) {
                ctx.fillRect(i, ground.y, 20, 10);
            }
            
            ctx.strokeStyle = '#3d7d00';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(0, ground.y);
            ctx.lineTo(canvas.width, ground.y);
            ctx.stroke();
        }
        
        function drawAnswers() {
            for (let i = 0; i < answerElements.length; i++) {
                const ans = answerElements[i];
                
                ctx.fillStyle = ans.color;
                ctx.beginPath();
                ctx.arc(ans.x, ans.y, ans.width/2, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(ans.x, ans.y, ans.width/2, 0, Math.PI * 2);
                ctx.stroke();
                
                ctx.fillStyle = 'white';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const text = ans.value.toString();
                if (text.length > 8) {
                    ctx.font = 'bold 16px Arial';
                }
                ctx.fillText(text, ans.x, ans.y);
            }
        }
        
        function drawMathBackground() {
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#1E90FF');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 2;
            
            for (let i = 0; i < canvas.width; i += 50) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            
            for (let i = 0; i < canvas.height; i += 50) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.font = '30px Arial';
            for (let i = 0; i < 20; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const symbols = ['+', '-', '×', '÷', '=', 'π', '∞'];
                const symbol = symbols[Math.floor(Math.random() * symbols.length)];
                ctx.fillText(symbol, x, y);
            }
        }
        
        function drawLanguageBackground() {
            const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            skyGradient.addColorStop(0, '#87CEEB');
            skyGradient.addColorStop(1, '#98FB98');
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'rgba(255, 255, 0, 0.8)';
            ctx.beginPath();
            ctx.arc(canvas.width - 100, 100, 50, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#8B4513';
            for (let i = 0; i < 5; i++) {
                const x = 100 + i * 200;
                ctx.fillRect(x, canvas.height - 200, 20, 130);
                
                ctx.fillStyle = '#228B22';
                ctx.beginPath();
                ctx.arc(x + 10, canvas.height - 200, 60, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#8B4513';
            }
            
            ctx.fillStyle = '#90EE90';
            ctx.fillRect(0, canvas.height - 70, canvas.width, 70);
            
        }
        
        function drawBackground() {
            if (gameMode === "math") {
                drawMathBackground();
            } else {
                drawLanguageBackground();
            }
        }
        
        function update() {
            if (!gameActive || levelComplete) return;
            
            player.velocityY += player.gravity;
            player.y += player.velocityY;
            
            if (player.y + player.height > ground.y) {
                player.y = ground.y - player.height;
                player.velocityY = 0;
                player.isJumping = false;
            }
            
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
            
            for (let i = answerElements.length - 1; i >= 0; i--) {
                const ans = answerElements[i];
                ans.x -= ans.speed;
                
                if (ans.x + ans.width < 0) {
                    answerElements.splice(i, 1);
                    
                    if (answerElements.length === 0) {
                        generateQuestion();
                    }
                }
                
                const distX = Math.abs(player.x + player.width/2 - (ans.x));
                const distY = Math.abs(player.y + player.height/2 - (ans.y));
                const distance = Math.sqrt(distX * distX + distY * distY);
                
                if (distance < (player.width/2 + ans.width/2)) {
                    if (ans.value === correctAnswer) {
                        score += 10;
                        correctStreak++;
                        totalCorrectAnswers++;
                        questionsAnswered++; 
                        
                        document.getElementById('scoreBox').textContent = `Score: ${score}`;
                        
                        createParticles(ans.x, ans.y, '#4cff00');
                        
                        playCorrectSound();
                        triggerBite();
                        
                        checkStarRewards();
                        
                        checkBadgeRewards();
                        
                        answerElements.splice(i, 1);
                        
                        generateQuestion();
                        
                        if (totalCorrectAnswers >= 10) {
                            completeLevel();
                        }
                    } else {
                        lives--;
                        correctStreak = 0;
                        questionsAnswered++;
                        
                        document.getElementById('livesBox').textContent = `Lives: ${lives}`;
                        createParticles(ans.x, ans.y, '#ff3366');
                        
                        playWrongSound();
                        
                        answerElements.splice(i, 1);
                        
                        if (lives <= 0) {
                            endGame();
                        } else {
                            generateQuestion();
                        }
                    }
                }
            }
        }
         
        function checkStarRewards() {
            if (correctStreak > 0 && correctStreak % 3 === 0) {
                if (correctStreak / 3 > earnedStars) {
                    earnedStars = Math.floor(correctStreak / 3);
                    playStarSound();
                    updateStarsDisplay();
                }
            }
            
            const starsFromTotal = Math.floor(totalCorrectAnswers / 5);
            if (starsFromTotal > earnedStars) {
                earnedStars = starsFromTotal;
                playStarSound();
                updateStarsDisplay();
            }
        }
        
        function checkBadgeRewards() {
            for (const badge of badges) {
                if (earnedBadges.includes(badge.id)) continue;
                
                let earned = false;
                
                switch (badge.type) {
                    case "streak":
                        if (correctStreak >= badge.requirement) earned = true;
                        break;
                    case "correct_total":
                        if (totalCorrectAnswers >= badge.requirement) earned = true;
                        break;
                    case "level_complete":
                        if (levelComplete) earned = true;
                        break;
                    case "stars":
                        if (earnedStars >= badge.requirement) earned = true;
                        break;
                }
                
                if (earned) {
                    earnedBadges.push(badge.id);
                    playBadgeSound();
                    updateBadgesDisplay();
                }
            }
        }
        
        function updateStarsDisplay() {
            const starsDisplay = document.getElementById('starsDisplay');
            starsDisplay.innerHTML = '';
            
            for (let i = 0; i < 5; i++) {
                const star = document.createElement('div');
                star.className = i < earnedStars ? 'star' : 'star inactive';
                starsDisplay.appendChild(star);
            }
        }
        
        function updateBadgesDisplay() {
            const badgesDisplay = document.getElementById('badgesDisplay');
            badgesDisplay.innerHTML = '';
            
            for (const badge of badges) {
                const badgeElement = document.createElement('div');
                badgeElement.className = earnedBadges.includes(badge.id) ? 'badge' : 'badge locked';
                badgeElement.textContent = badge.id.charAt(0).toUpperCase();
                badgeElement.title = earnedBadges.includes(badge.id) ? 
                    `${badge.name}: ${badge.description}` : 
                    `Locked: ${badge.description}`;
                badgesDisplay.appendChild(badgeElement);
            }
        }
        
        function completeLevel() {
            levelComplete = true;
            gameActive = false;
            document.getElementById('winMessage').textContent = 'Level Complete!';
            document.getElementById('winText').textContent = `Congratulations! You answered ${totalCorrectAnswers} questions correctly with ${earnedStars} stars!`;
            document.getElementById('winScreen').style.display = 'block';
            
            checkBadgeRewards();
        }
        
        const particles = [];
        function createParticles(x, y, color) {
            for (let i = 0; i < 20; i++) {
                particles.push({
                    x: x,
                    y: y,
                    size: Math.random() * 8 + 4,
                    speedX: (Math.random() - 0.5) * 10,
                    speedY: (Math.random() - 0.5) * 10,
                    color: color,
                    alpha: 1,
                    life: Math.random() * 30 + 20
                });
            }
        }
        
        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.speedX;
                p.y += p.speedY;
                p.alpha -= 0.02;
                p.life--;
                
                if (p.life <= 0 || p.alpha <= 0) {
                    particles.splice(i, 1);
                }
            }
        }
        
        function drawParticles() {
            for (const p of particles) {
                ctx.globalAlpha = p.alpha;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            }
            ctx.globalAlpha = 1;
        }
        
        function endGame() {
            gameActive = false;
            document.getElementById('finalScore').textContent = `Score: ${score}`;
            document.getElementById('gameOver').style.display = 'block';
        }
        
        function resetGame() {
            score = 0;
            lives = 3;
            gameActive = true;
            levelComplete = false;
            correctStreak = 0;
            totalCorrectAnswers = 0;
            questionsAnswered = 0;
            earnedStars = 0;
            isBiting = false;
            player.x = 100;
            player.y = canvas.height - 150;
            player.velocityY = 0;
            document.getElementById('scoreBox').textContent = `Score: ${score}`;
            document.getElementById('livesBox').textContent = `Lives: ${lives}`;
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('winScreen').style.display = 'none';
            particles.length = 0;
            answerElements = [];
            updateStarsDisplay();
            updateBadgesDisplay();
            generateQuestion();
        }
        
        function startGame() {
            gameMode = document.getElementById('gameMode').value;
            
            if (gameMode === "math") {
                minNum = parseInt(document.getElementById('minNum').value);
                maxNum = parseInt(document.getElementById('maxNum').value);
                
                if (minNum >= maxNum) {
                    alert("Min number must be less than Max number!");
                    return;
                }
            } else {
                languageLevel = document.getElementById('languageLevel').value;
            }
            
            document.getElementById('settingsPanel').style.display = 'none';
            
            gameActive = true;
            resetGame();
            
            playBackgroundMusic();
        }
        
        function jump() {
            if (!gameActive || levelComplete) return;
            if (!player.isJumping) {
                player.velocityY = player.jumpPower;
                player.isJumping = true;
                playJumpSound();
            }
        }
        
        function move(direction) {
            if (!gameActive || levelComplete) return;
            player.x += player.speed * direction;
        }
        
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowUp' || e.key === ' ' || e.key === 'w') {
                jump();
            } else if (e.key === 'ArrowLeft' || e.key === 'a') {
                move(-1);
            } else if (e.key === 'ArrowRight' || e.key === 'd') {
                move(1);
            } else if (e.key === 'r') {
                if (!gameActive) resetGame();
            }
        });
        
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            jump();
        });
        
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('restartBtn').addEventListener('click', () => {
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('settingsPanel').style.display = 'block';
        });
        document.getElementById('nextLevelBtn').addEventListener('click', () => {
            document.getElementById('winScreen').style.display = 'none';
            document.getElementById('settingsPanel').style.display = 'block';
        });
        
        updateStarsDisplay();
        updateBadgesDisplay();
        
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            drawBackground();
            drawGround();
            drawAnswers();
            drawPlayer();
            drawParticles();
            
            update();
            updateParticles();
            
            requestAnimationFrame(gameLoop);
        }
        
        gameLoop();
    </script>
</body>
</html>